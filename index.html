<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="reveal/css/reveal.css">
    <link rel="stylesheet" href="reveal/css/theme/kontur-light.css" id="theme">
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="reveal/css/highlight/idea-for-light.css">
    <link rel="stylesheet" href="reveal/css/highlight/darkula-for-dark.css">
    <!--[if lt IE 9]>
    <script src="reveal/js/html5shiv.js"></script>
    <![endif]-->
	<script defer src="reveal/js/head.min.js"></script>
	<script defer src="reveal/js/reveal.js"></script>
	<script defer src="reveal/initialize.js"></script>
	<script defer src="reveal/js/d3.min.js"></script>

    <style>
		.fragment-container {
			position: relative;
		}

		.fragment-container .fragment {
			position: absolute;
			top: 0px;
			width: 100%;
		}

        .tools.tools {
          margin: -30% auto 0;
          height: 100vh;
          display: block;
        }
    </style>

	<title>Печать документов</title>
</head>
<body>

<div class="reveal"><div class="slides">

<section data-markdown><script type="text/template">

# Печать документов

<p style="text-align: center;"><a href="https://github.com/vanyaraspopov/print-with-react">https://github.com/vanyaraspopov/print-with-react</a></p>

</script></section>

<section data-markdown><script type="text/template">

### Постановка задачи

Есть стандартное TODO приложение

<img src="assets/todo_app.png" alt="todo">

***

Нужно вывести задачи на печать согласно прототипу

<img src="assets/print_view.png" alt="todo">


</script></section>

<section data-markdown><script type="text/template">

### Простое решение

Можно использовать css медиа-запрос `print`

```css
@media print {
  ...
}
```

переопределить в нём все классы, приведя страницу к виду прототипа, и вызвать метод

```js
window.print()
```

<span class="fragment fade-in">⚠️ это может быть очень трудоёмко</span>
<span class="fragment fade-in">⚠️ возможны конфликты стилей</span>

</script></section>

<section data-markdown><script type="text/template">

### Реальный случай

Информация, которую нужно напечатать, тянется с сервера и показывается в модальном окне
<img src="assets/modal.png" alt="modal" height="500">

***


<div style="text-align: left; float: left;">
  <img src="assets/prototype.png" alt="prototype" height="600">
</div>

<div style="text-align: left; float: right;">
  <p data-markdown>
    Прототип печатной формы
  </p>
  <span class="fragment fade-in">можно попробовать
    `visibility: hidden` для всего,
    кроме печатной формы</span>

  <span class="fragment fade-in">⚠️ проблемы с box size</span>
  <span class="fragment fade-in">⚠️ по-прежнему возможны
    конфликты стилей</span>
</div>

</script></section>

<section data-markdown><script type="text/template">

### Решение

0. Для печатной формы документа создаём React-компонент, который содержит логику отображения документа
0. При клике на кнопку "Печать" создаём новый фрейм
0. Рендерим компонент в этот фрейм
0. Вызываем print у фрейма
0. PROFIT!

<span class="fragment fade-in">⚠️ есть проблемы с подключением стилей )</span>

</script></section>

<section data-markdown><script type="text/template">

### Реализация

Функция печати

```js
import React from 'react';
import {render} from 'react-dom';

export function print(reactComponent) {
    const frame = document.createElement('iframe');
    frame.style.display = 'none';
    document.body.appendChild(frame);
    const _window = frame.contentWindow;
    _window.document.body.appendChild(_window.document.createElement('div'));
    render(reactComponent, _window.document.body.children[0]);
    _window.print();
    document.body.removeChild(frame);
}


```

***

Пишем стили в компоненте внутри тега `style`

```js
import React from 'react';

export default function TodoListPrintView(props) {
  return (
    <div>
      <style>
        .container {
          ...
        }
      </style>
      <div className="container">
        ...
      </div>
    </div>
  );
}
```
<span class="fragment fade-in">:( хочется подсветки синтаксиса</span>
<span class="fragment fade-in">:( хочется использовать препроцессоры</span>

***

Правила в конфигурации webpack

```js
{
  test: /\.less$/,
  exclude: /\.print\.less$/,
  use: ['style-loader', 'css-loader', 'less-loader'],
},
{
  test: /\.less$/,
  include: /\.print\.less$/,
  use: ['css-to-string-loader', 'css-loader', 'less-loader'],
},
```

стили, которые должны быть преобразованы в строку, обозначаются суффиксом `.print`

***

Код компонента печатной формы

```js
import React from 'react';

const css = require('./TodoListPrintView.print.less');

export default function TodoListPrintView(props) {
  return (
    <div>
      <style>{css}</style>
      <div className="container">
        ...
      </div>
    </div>
  );
}
```

- в переменной `css` содержатся стили компонента
- полная изоляция стилей

</script></section>

</div></div>
</body>
</html>
